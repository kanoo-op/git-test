# PostureView - 임상 자세 분석 3D 뷰어

Three.js 기반 인체 해부학 3D 뷰어로, 환자별 근골격계 평가를 기록하고 시각화하는 웹 애플리케이션입니다.

## 주요 기능

### 대시보드
- **통계 카드**: 전체 환자 수, 전체 평가 수, 오늘 평가 수 한눈에 확인
- **심각도 분포**: 정상/경도/중등도/중증 비율 바 차트
- **최근 환자**: 최근 평가를 받은 환자 5명 빠른 접근
- **최근 평가**: 최근 평가 10건 목록

### 3D 뷰어
- **GLB 모델 로딩**: 고해상도 원본 모델(153MB)
- **메쉬 인터랙션**: 마우스 호버 시 조직명/부위 툴팁 표시, 클릭으로 상세 정보 확인
- **카메라 프리셋**: 전면/후면/좌측/우측/상단/초기화 뷰 전환 (부드러운 애니메이션)
- **조직 레이어 제어**: 근육, 뼈, 힘줄, 인대, 연골, 관절낭 각각의 표시/숨김 및 불투명도 조절

### 환자 관리
- **환자 등록/수정/삭제**: 이름, 생년월일, 성별, 연락처, 이메일, 진단명, 병력, 직업, 메모
- **검색**: 이름으로 환자 실시간 검색
- **정렬**: 이름순, 등록일순, 평가 수순 정렬
- **환자 상세 페이지**: 프로필 정보 + 빠른 통계 + 평가 타임라인
- **개별 환자 내보내기**: 해당 환자 데이터 JSON 다운로드
- **인쇄**: 환자 상세 페이지 인쇄 레이아웃 지원
- **데이터 영속성**: localStorage에 자동 저장, JSON 백업/복원 지원

### 근골격계 평가
- **평가 모드**: 환자 선택 후 "새 평가" 시작 → 3D 모델에서 관심 부위 클릭
- **심각도 분류**: 정상(녹색) / 경도(황색) / 중등도(주황) / 중증(빨강) 4단계
- **메모 기록**: 부위별 관찰 소견, ROM 제한, 통증 정도 등 기록
- **전체 메모**: 평가 종료 시 전체 소견 메모 입력
- **자동 요약**: 평가 종료 시 심각도별 개수 + 관심 부위 자동 생성
- **3D 상태 저장/복원**: 평가 시 하이라이트된 메쉬 상태가 저장되어 나중에 동일하게 복원
- **평가 이어하기**: 이전 평가를 불러와서 추가 편집 가능
- **평가 비교**: 2개 평가를 선택하여 부위별 심각도 변화(개선/악화/유지) 비교

### 부위 매핑 시스템
- **자동 감지**: 메쉬 바운딩 박스 Y축 위치 기반으로 신체 부위 자동 분류 (15개 부위)
- **JSON 매핑**: 커스텀 매핑 파일 불러오기/내보내기로 정밀한 부위 지정
- **매핑 에디터**: 부위 추가/삭제, 3D 모델 클릭으로 메쉬 할당/제거

### 하이라이트 시스템
- **3단계 하이라이트**: 호버(흰색, 일시적) → 선택(파랑, 일시적) → 평가(심각도별 색상, 영구)
- **독립 운영**: 매핑 에디터와 평가 하이라이트가 서로 간섭하지 않음

## 기술 스택

| 항목 | 기술 |
|------|------|
| 3D 렌더링 | Three.js r170 |
| 3D 모델 | GLB (glTF Binary) |
| 카메라 제어 | OrbitControls |
| 데이터 저장 | localStorage |
| 모듈 시스템 | ES Modules (import map) |

## 프로젝트 구조

```
├── index.html                 # 메인 HTML (UI 레이아웃)
├── css/
│   └── styles.css             # 전체 스타일시트
├── js/
│   ├── app.js                 # 엔트리포인트, 이벤트 코디네이터
│   ├── viewer.js              # Three.js 씬, 카메라, 모델 로딩
│   ├── controls.js            # OrbitControls, 레이캐스팅, 카메라 프리셋
│   ├── highlights.js          # 메쉬 하이라이트, 조직 가시성, 선택 시스템
│   ├── panels.js              # 대시보드, 환자 관리, 평가, 매핑 에디터
│   ├── regions.js             # 신체 부위 매핑 (자동 감지 + JSON 매핑)
│   ├── sidebar.js             # 사이드바 네비게이션, 조직 토글
│   └── storage.js             # localStorage CRUD (환자, 평가, 통계, 매핑)
├── OriginalMuscular002.glb    # 원본 고해상도 3D 모델 (153MB, LFS)
├── mapping001.json            # 샘플 부위 매핑 파일
└── package.json               # Node.js 설정
```

## 실행 방법

로컬 HTTP 서버가 필요합니다 (ES Modules + GLB 로딩을 위해 `file://` 프로토콜 불가).

```bash
# 방법 1: npx
npx serve .

# 방법 2: Python
python -m http.server 8000

# 방법 3: VS Code Live Server 확장
```

브라우저에서 `http://localhost:3000` (또는 해당 포트)으로 접속합니다.

## 조작법

| 동작 | 조작 |
|------|------|
| 회전 | 좌클릭 + 드래그 |
| 이동 | 우클릭 + 드래그 |
| 확대/축소 | 마우스 휠 |
| 메쉬 선택 | 좌클릭 |
| 메쉬 할당 해제 (매핑 에디터) | 우클릭 |
